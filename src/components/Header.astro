---
import ThemeToggle from './ThemeToggle.astro';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');

const navItems = [
  { label: 'Art', href: `${base}/art/` },
  { label: 'Whispers of the Heartwood', href: `${base}/whispers/` },
  { label: 'Poetry', href: `${base}/poetry/` },
  { label: 'Blog', href: 'https://audreys-evergreene-newsletter.beehiiv.com/', external: true },
  { label: 'About', href: `${base}/about/` },
];

const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-bg/90 backdrop-blur-md shadow-[0_1px_3px_rgba(0,0,0,0.1)]">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <a href={`${base}/`} class="font-script text-2xl bg-gradient-to-br from-gold-100 via-gold-200 to-blush-200 bg-clip-text text-transparent hover:opacity-80 transition-opacity">
        AnEvergreene Forest
      </a>

      <!-- Desktop navigation + theme toggle -->
      <div class="hidden sm:flex items-center gap-4">
        <nav class="flex items-center gap-6">
          {navItems.map(({ label, href, external }) => (
            <a
              href={href}
              {...(external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
              class:list={[
                'text-sm font-medium transition-colors inline-flex items-center gap-1',
                !external && (currentPath === href || (href !== '/' && currentPath.startsWith(href)))
                  ? 'text-accent'
                  : 'text-text-muted hover:text-text',
              ]}
            >
              {label}
              {external && (
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
              )}
            </a>
          ))}
        </nav>
        <ThemeToggle />
      </div>

      <!-- Mobile: theme toggle + menu button -->
      <div class="sm:hidden flex items-center gap-2">
        <ThemeToggle />
        <button
          id="mobile-menu-btn"
          class="p-2 text-text-muted rounded-lg"
          aria-label="Toggle menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile navigation -->
    <nav id="mobile-menu" class="sm:hidden hidden pb-6 pt-2 space-y-1">
      {navItems.map(({ label, href, external }) => (
        <a
          href={href}
          {...(external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          class:list={[
            'block py-3 px-3 text-base font-medium transition-colors rounded-lg inline-flex items-center gap-1',
            !external && (currentPath === href || (href !== '/' && currentPath.startsWith(href)))
              ? 'text-accent'
              : 'text-text-muted hover:text-text',
          ]}
        >
          {label}
          {external && (
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          )}
        </a>
      ))}
    </nav>
  </div>
</header>

<script>
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => menu?.classList.toggle('hidden'));
</script>
